<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4YouStore | Database Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: white;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
        }

        .input-gradient {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .input-gradient:focus {
            border-color: #38bdf8;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
            outline: none;
        }

        .btn-primary {
            background: linear-gradient(90deg, #0ea5e9 0%, #2563eb 100%);
            transition: transform 0.2s active;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
    </style>
</head>
<body class="p-6 md:p-12">

    <div class="max-w-4xl mx-auto">
        <div class="flex items-center justify-between mb-10">
            <div>
                <h1 class="text-3xl font-bold tracking-tight text-white">Database Control</h1>
                <p class="text-slate-400 mt-1">Manage repository: <span class="text-sky-400 font-mono text-sm">Keamanan/Dbnomor.json</span></p>
            </div>
            <div class="bg-sky-500/10 p-3 rounded-2xl">
                <i data-lucide="shield-check" class="text-sky-400 w-8 h-8"></i>
            </div>
        </div>

        <div class="grid md:grid-cols-5 gap-8">
            <div class="md:col-span-2 space-y-6">
                <div class="glass-card p-6">
                    <div class="flex items-center gap-3 mb-6">
                        <i data-lucide="user-plus" class="w-5 h-5 text-sky-400"></i>
                        <h2 class="font-semibold text-lg">Add Number</h2>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-medium text-slate-400 uppercase tracking-wider mb-2">WhatsApp Number</label>
                            <input type="text" id="newNumber" 
                                class="w-full input-gradient px-4 py-3 rounded-xl text-white placeholder-slate-500"
                                placeholder="e.g. 628123xxx">
                        </div>
                        
                        <button onclick="handleProcess()" id="btnSubmit" 
                            class="w-full btn-primary py-3 rounded-xl font-semibold flex items-center justify-center gap-2">
                            <span>Update Database</span>
                        </button>
                    </div>
                </div>

                <div id="statusBox" class="hidden p-4 rounded-xl text-sm font-medium border animate-pulse"></div>
            </div>

            <div class="md:col-span-3">
                <div class="glass-card p-6 h-full min-h-[400px] flex flex-col">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <i data-lucide="database" class="w-5 h-5 text-sky-400"></i>
                            <h2 class="font-semibold text-lg">Registered Numbers</h2>
                        </div>
                        <button onclick="fetchData()" class="text-slate-400 hover:text-white transition-colors">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        </button>
                    </div>

                    <div id="numberList" class="space-y-2 overflow-y-auto max-h-[400px] pr-2">
                        <p class="text-slate-500 text-center py-10 italic">Loading database...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // KONFIGURASI (Ganti dengan token Anda!)
    const CONFIG = {
        token: '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',
        owner: 'Reyz4YouOfficial',
        repo: 'Keamanan',
        path: 'Dbnomor.json'
    };

    const API_URL = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`;

    // Initialize Icons
    lucide.createIcons();

    // Load Data on Startup
    window.onload = fetchData;

    async function fetchData() {
        try {
            const res = await axios.get(API_URL, {
                headers: { Authorization: `token ${CONFIG.token}` }
            });
            const data = JSON.parse(atob(res.data.content));
            renderList(data.dbny);
        } catch (err) {
            console.error(err);
        }
    }

    function renderList(numbers) {
        const container = document.getElementById('numberList');
        if (!numbers || numbers.length === 0) {
            container.innerHTML = `<p class="text-slate-500 text-center py-10">Database kosong</p>`;
            return;
        }
        
        container.innerHTML = numbers.map(num => `
            <div class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5 hover:bg-white/10 transition-all">
                <span class="font-mono text-slate-200">+${num}</span>
                <span class="text-[10px] bg-sky-500/20 text-sky-400 px-2 py-1 rounded-full uppercase tracking-tighter font-bold">Verified</span>
            </div>
        `).join('');
    }

    async function handleProcess() {
        const input = document.getElementById('newNumber');
        const btn = document.getElementById('btnSubmit');
        const number = input.value.replace(/[^0-9]/g, '');

        if (!number) return showStatus('Nomor tidak valid!', 'error');

        btn.disabled = true;
        btn.innerHTML = `<span class="animate-spin">ðŸŒ€</span> Processing...`;

        try {
            const res = await axios.get(API_URL, {
                headers: { Authorization: `token ${CONFIG.token}` }
            });

            const sha = res.data.sha;
            let jsonData = JSON.parse(atob(res.data.content));

            if (jsonData.dbny.includes(number)) {
                showStatus('Nomor sudah terdaftar di database!', 'warning');
            } else {
                jsonData.dbny.push(number);
                const updatedContent = btoa(JSON.stringify(jsonData, null, 2));

                await axios.put(API_URL, {
                    message: `Web Update: Added ${number}`,
                    content: updatedContent,
                    sha: sha
                }, {
                    headers: { Authorization: `token ${CONFIG.token}` }
                });

                showStatus('Berhasil ditambahkan!', 'success');
                input.value = '';
                fetchData(); // Refresh list
            }
        } catch (error) {
            showStatus('Gagal: ' + error.message, 'error');
        } finally {
            btn.disabled = false;
            btn.innerHTML = `Update Database`;
        }
    }

    function showStatus(msg, type) {
        const box = document.getElementById('statusBox');
        box.classList.remove('hidden', 'bg-red-500/10', 'text-red-400', 'border-red-500/20', 'bg-green-500/10', 'text-green-400', 'border-green-500/20', 'bg-yellow-500/10', 'text-yellow-400', 'border-yellow-500/20');
        
        box.classList.add('block');
        if(type === 'error') box.classList.add('bg-red-500/10', 'text-red-400', 'border-red-500/20');
        if(type === 'success') box.classList.add('bg-green-500/10', 'text-green-400', 'border-green-500/20');
        if(type === 'warning') box.classList.add('bg-yellow-500/10', 'text-yellow-400', 'border-yellow-500/20');
        
        box.innerText = msg;
        setTimeout(() => box.classList.add('hidden'), 5000);
    }
</script>
</body>
</html>
